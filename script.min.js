"use strict";function close_modal_window(){document.querySelector(".modal-bg").classList.remove("show-modal-bg")}function filter_by_line_type(e){let t=[];if(document.querySelectorAll(".checkbox-filter-lines").forEach(e=>{e.checked||t.push(e.value)}),!document.getElementById("filter_list_lines")){let l=document.createElement("style");l.id="filter_list_lines",document.head.appendChild(l)}if(0<t.length&&t.length<3){let a=[];t.forEach(e=>{a.push(`.table-all-lines tr[data-tab="${e}"] {display:none}`)}),filter_list_lines.innerText=a.join("")}else filter_list_lines.innerText=""}function get_data_db(e){let t={phone_number:"–",category:"–",connected:"–"};return e&&(t.phone_number=String(e[0]).replace(/(\d)(\d{2})(\d{2})/,"6$1-$2-$3"),t.category=e[1],1==e[2]?t.connected='<span class="phone-on">Да</span>':2==e[2]?t.connected='<span class="phone-unpaid" tabindex="0" data-tooltip="Исходящий вызов отключён за неуплату">Да</span>':t.connected='<span class="phone-off">Нет</span>'),t}function show_modal_window(e){if(document.querySelector("#modal-window-content").innerHTML="","default"==e.template){let t=document.querySelector("#template-default").content.cloneNode(!0);document.querySelector("#modal-window-content").appendChild(t),document.querySelector(".modal-window").setAttribute("data-template",e.template),document.querySelector("#modal-window-item-value-area").innerText=e.area,document.querySelector("#modal-window-item-value-mak").innerText=e.mak,document.querySelector("#modal-window-item-value-tract").innerText=e.tract,document.querySelector("#modal-window-item-value-line").innerText=e.line,document.querySelector("#modal-window-item-value-phone").innerText=e.phone_number,document.querySelector("#modal-window-item-value-category").innerText=e.category,document.querySelector("#modal-window-item-value-connected").innerHTML=e.connected}else if("all-lines"==e.template){let l=document.querySelector("#template-all-lines").content.cloneNode(!0);document.querySelector("#modal-window-content").appendChild(l),document.querySelector(".modal-window").setAttribute("data-template",e.template),document.querySelector(".tab-count-connected-lines").innerHTML=e.connected,document.querySelector(".tab-count-disconnected-lines").innerHTML=e.disconnected,document.querySelector(".tab-count-free-lines").innerHTML=e.free,document.querySelector(".table-all-lines").innerHTML+=e.list_lines,0<e.connected&&(document.querySelector('.checkbox-filter-lines[value="connected"]').checked=!0),filter_by_line_type(document.querySelectorAll(".table-all-lines tr")),document.querySelectorAll(".checkbox-filter-lines").forEach(e=>{e.addEventListener("change",()=>{filter_by_line_type(document.querySelectorAll(".table-all-lines tr"))})})}else if("details"==e.template){let a=document.querySelector("#template-details").content.cloneNode(!0);document.querySelector("#modal-window-content").appendChild(a),document.querySelector(".modal-window").setAttribute("data-template",e.template),document.querySelector("#total-count-area-1").innerText=get_text_with_transcript(e.total_count_area_1),document.querySelector("#total-count-area-2").innerText=get_text_with_transcript(e.total_count_area_2),document.querySelector("#details-tract-area-1").innerHTML=e["details-tract-area-1"],document.querySelector("#details-tract-area-2").innerHTML=e["details-tract-area-2"]}else if("error"==e.template){let n=document.querySelector("#template-error").content.cloneNode(!0);document.querySelector("#modal-window-content").appendChild(n),document.querySelector(".modal-window").setAttribute("data-template",e.template),document.querySelector("#error-message").innerText=e.text}else if("info"==e.template){let o=document.querySelector("#template-info").content.cloneNode(!0);document.querySelector("#modal-window-content").appendChild(o),document.querySelector(".modal-window").setAttribute("data-template",e.template),document.querySelector("#info-message").innerText=e.text}let r=document.querySelector(".modal-window").classList;for(var i=r.length-1;i>=0;i--)"modal-window"!=r[i]&&r.remove(r[i]);document.querySelector(".modal-bg").classList.add("show-modal-bg")}function check_value(e,t,l,a=null){try{if("А"==e){if(!t||!(1<=t&&15>=t))throw 0}else if(!t||!(1<=t&&10>=t))throw 1;if(!l||!(0<=l&&31>=l))throw 2;if(null!=a&&(!a||!(1<=a&&63>=a)))throw 3}catch(n){return show_modal_window({template:"error",text:["Указан некорректный номер модуля МАК. Для площадки \xabА\xbb принимаются только цифры в диапазоне от 1 до 15.","Указан некорректный номер модуля МАК. Для площадки \xabБ\xbb принимаются только цифры в диапазоне от 1 до 10.","Указан некорректный номер тракта. Принимаются только цифры в диапазоне от 0 до 31.","Указан некорректный номер линии. Принимаются только цифры в диапазоне от 1 до 63."][n]}),!0}}function install_max_limit(e){let t="phone-area"==e.name?"#phone-mak":"#lines-mak",l="А"==e.value?15:10;document.querySelector(t).max=l}function accordion_details_tract(e){e.nextElementSibling.classList.contains("show-details-list-tract")?(e.classList.remove("details-open-link-active"),e.nextElementSibling.classList.remove("show-details-list-tract")):(e.classList.add("details-open-link-active"),e.nextElementSibling.classList.add("show-details-list-tract"))}function get_text_with_transcript(e,t=!1){let l="";return"1"==(e=String(e)).slice(-1)&&"11"!=e.slice(-2)?(t&&(l="подключена "),l+e+" линия"):["2","3","4"].includes(e.slice(-1))&&!["12","13","14"].includes(e.slice(-2))?(t&&(l="подключены "),l+e+" линии"):(t&&(l="подключено "),l+e+" линий")}function show_details(){let e={А:{total:0},Б:{total:0}};for(let t in db)if("ver"!=t)for(let l in db[t])for(let a in db[t][l])for(let n in db[t][l][a])db[t][l][a][n][2]&&(e[t].total+=1,l in e[t]?e[t][l].total+=1:e[t][l]={total:1},a in e[t][l]?e[t][l][a].total+=1:e[t][l][a]={total:1});let o={template:"details",total_count_area_1:e["А"].total,total_count_area_2:e["Б"].total,"details-tract-area-1":"","details-tract-area-2":""};for(let r=1;r<=15;r++){o["details-tract-area-1"]+=`<li class="details-open-link">МАК ${("0"+r).slice(-2)}: ${e["А"][r].total}</li><ul class="details-list-tract">`;for(let i=0;i<=31;i++)i in e["А"][r]?o["details-tract-area-1"]+=`<li>Тракт ${i}: ${e["А"][r][i].total}</li>`:o["details-tract-area-1"]+=`<li>Тракт ${i}: –</li>`;o["details-tract-area-1"]+="</ul>"}for(let c=1;c<=10;c++){o["details-tract-area-2"]+=`<li class="details-open-link">МАК ${("0"+c).slice(-2)}: ${e["Б"][c].total}</li><ul class="details-list-tract">`;for(let d=0;d<=31;d++)d in e["Б"][c]?o["details-tract-area-2"]+=`<li>Тракт ${d}: ${e["Б"][c][d].total}</li>`:o["details-tract-area-2"]+=`<li>Тракт ${d}: –</li>`;o["details-tract-area-2"]+="</ul>"}show_modal_window(o)}function get_linear_data(){let e=document.querySelector("#input-phone").value;return 6!=(e=e.replace(/[^\d]/g,"")).length?(show_modal_window({template:"error",text:"Указан некорректный номер телефона. Правильный номер должен состоять из 6 цифр в диапазоне от 610000 до 659999."}),!1):null==e.match(/6[1-5]\d{4}/)?(show_modal_window({template:"error",text:"Указанный номер телефона не принадлежит АТС \xabC-32\xbb."}),!1):!function(e){for(let t in db)if("ver"!=t){for(let l in db[t])for(let a in db[t][l])for(let n in db[t][l][a])if(e.slice(1)==db[t][l][a][n][0]){let o=get_data_db(db[t][l][a][n]);return show_modal_window({template:"default",area:t,mak:l,tract:a,line:n,phone_number:o.phone_number,category:o.category,connected:o.connected}),!0}}}(e)?(show_modal_window({template:"info",text:"Указанный номер телефона отсутствует в базе данных абонентов."}),!1):void 0}function get_phone_number(){let e=document.querySelector('input[name="phone-area"]:checked').value,t=document.querySelector("#phone-mak").value,l=document.querySelector("#phone-tract").value,a=document.querySelector("#phone-line").value;if(check_value(e,t,l,a))return!1;let n=get_data_db(db[e][t][l][a]);show_modal_window({template:"default",area:e,mak:t,tract:l,line:a,phone_number:n.phone_number,category:n.category,connected:n.connected})}function get_all_lines_data(){let e=document.querySelector('input[name="lines-area"]:checked').value,t=document.querySelector("#lines-mak").value,l=document.querySelector("#lines-tract").value,a=`<tr><th>Площадка</th><th>МАК</th><th>Тракт</th><th>Линия</th><th>Номер телефона</th><th>Категория</th><th>Подключён</th></tr>`,n=0,o=0,r=0;if(check_value(e,t,l))return!1;for(let i=1;i<=63;i++){let c="";i in db[e][t][l]?db[e][t][l][i][2]?(o+=1,c="connected"):(r+=1,c="disconnected"):(n+=1,c="free");let d=get_data_db(db[e][t][l][i]);a+=`<tr data-tab="${c}"><td>${e}</td><td>${t}</td><td>${l}</td><td>${i}</td><td>${d.phone_number}</td><td>${d.category}</td><td>${d.connected}</td></tr>`}show_modal_window({template:"all-lines",connected:o,disconnected:r,free:n,list_lines:a})}document.addEventListener("DOMContentLoaded",function(){"file:"==document.location.protocol&&(document.querySelector(".download").style.display="none");let e=db.ver.replace(/([\d]{2})([\d]{2})([\d]{2})([\d]{2})([\d]{2})/,"$3.$2.20$1 в $4:$5");document.querySelector("#version-db").textContent=e;let t=0;for(let l in db)if("ver"!=l)for(let a in db[l])for(let n in db[l][a])for(let o in db[l][a][n])db[l][a][n][o][2]&&(t+=1);document.querySelector("#total-connected").textContent=get_text_with_transcript(t,!0),document.querySelector(".modal-bg").addEventListener("mousedown",function(e){e.target.classList.contains("modal-wrapper")?close_modal_window():e.target.classList.contains("modal-bg")&&document.querySelector(".modal-bg").clientWidth>window.event.pageX&&close_modal_window()}),document.querySelector("body").addEventListener("mousedown",function(e){e.target.classList.contains("details-open-link")&&accordion_details_tract(e.target)}),document.addEventListener("keydown",function(e){"Enter"==e.key&&["INPUT","BUTTON"].includes(document.activeElement.tagName)&&(e.target.blur(),window[e.target.dataset.func]()),"Escape"==e.key&&document.querySelector(".modal-bg").classList.contains("show-modal-bg")&&close_modal_window()})});